version: 2

models:
  - name: stg_app_users
    description: >
      Staging model for app users, flattened & typed from raw_app.users.

      Grain:
      • One row per user_id (latest processed event_ts)
      • Represents current/latest known state of each user
      • Historical changes are captured in snapshot_users_scd2

    config:
      contract:
        enforced: true

    columns:

      - name: user_id
        data_type: bigint
        description: "Business identifier of the user."
        tests:
          - not_null
          - unique

      - name: user_created_at
        data_type: timestamp
        description: "Timestamp when the user account was created."

      - name: event_ts
        data_type: timestamp
        description: "Source change timestamp used for incremental + SCD2."
        tests:
          - not_null

      - name: status
        data_type: string
        description: "User lifecycle status."

      - name: country_code
        data_type: string
        description: "ISO country code."

      - name: timezone
        data_type: string
        description: "User timezone identifier."

      - name: is_test_user
        data_type: boolean
        description: "Flag for internal / QA users."

      - name: marketing_source
        data_type: string
        description: "User acquisition source."

      - name: first_name
        data_type: string
      - name: city
        data_type: string
      - name: birthdate
        data_type: date
      - name: gender
        data_type: string
      - name: orientation
        data_type: string
      - name: height_cm
        data_type: int
      - name: education_level
        data_type: string
      - name: employer
        data_type: string
      - name: job_title
        data_type: string
      - name: approx_country_code
        data_type: string
      - name: approx_lat
        data_type: double
      - name: approx_lon
        data_type: double
      - name: pref_gender
        data_type: string
      - name: pref_min_age
        data_type: int
      - name: pref_max_age
        data_type: int
      - name: pref_max_distance_km
        data_type: int
